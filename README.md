
# Wiki文档系统  

## 概述  
这是一个基于Flask的文档协作系统，集成了GitHub功能，支持多人协同编辑和审阅文档。系统提供基于角色的权限控制、内容变更审核流程，以及与GitHub仓库的无缝同步。  

## 系统架构  

### 后端架构  
- **框架**：Flask（Python Web框架）  
- **数据库**：SQLAlchemy ORM（默认SQLite，支持PostgreSQL）  
- **认证模块**：Flask-Login会话管理  
- **安全机制**：Werkzeug密码哈希与安全工具  

### 前端架构  
- **模板引擎**：Jinja2  
- **样式**：Bootstrap 5深色主题  
- **交互**：原生JavaScript + CodeMirror代码编辑器  
- **图标库**：Font Awesome图标集  

### 数据库结构  
核心数据模型：  
- **用户**：存储账户信息（管理员/普通用户）  
- **系统配置**：键值对形式存储全局配置  
- **内容审核**：追踪变更记录与审核流程  

## 核心功能  

### 账户系统  
- 用户注册/登录功能  
- 角色权限分级（管理员可直通操作）  
- 默认管理员账户：admin/wenjiaxian88  
- 用户个人GitHub令牌存储  

### 文件管理  
- GitHub仓库文件存储  
- 本地仓库同步机制  
- 树状目录文件浏览器  
- CodeMirror语法高亮编辑器  
- 多格式文件支持（自动匹配语法高亮）  

### 审核流程  
- 非管理员需内容审核（管理员可直通同步）  
- 变更差异可视化对比  
- 带批注的审核/驳回系统  
- 待审队列管理  

### GitHub集成  
- 仓库克隆与同步  
- 个人访问令牌管理  
- 实时浏览GitHub文件树  
- 自动拉取最新更新  

## 数据流  

1. **文件编辑流程**：  
   - 用户浏览 → 选择文件 → CodeMirror编辑 → 保存  
   - 普通用户：变更进入审核队列  
   - 管理员：可选直通GitHub同步  

2. **审核流程**：  
   - 变更生成审核记录  
   - 管理员处理队列任务  
   - 通过则同步至GitHub  
   - 驳回则反馈修改意见  

3. **同步流程**：  
   - 系统维护本地仓库副本  
   - 定时拉取GitHub更新  
   - 审核通过后推送至云端  

## 依赖组件  

### Python依赖包  
- Flask及其扩展组件（SQLAlchemy/Login）  
- PyGithub（GitHub API交互）  
- GitPython（Git操作库）  
- Werkzeug（安全工具包）  

### 前端库  
- Bootstrap 5（CDN引入）  
- CodeMirror代码编辑器  
- Font Awesome图标库  
- 定制化CSS样式  

### GitHub集成要求  
- 需具备`repo`权限的GitHub个人访问令牌  
- 令牌需有仓库访问权限  
- 通过GitHub API操作仓库  

## 部署方案  

### 配置管理  
- 环境变量配置数据库URL和会话密钥  
- 系统参数存于数据库（GitHub令牌/仓库信息）  
- 支持开发环境（SQLite）与生产环境（PostgreSQL）  

### 安全措施  
- Werkzeug加密存储密码  
- Flask-Login会话管理  
- GitHub令牌数据库加密存储  
- 反向代理适配机制（WSGI代理修复）  

### 开发配置  
- 默认SQLite本地开发数据库  
- main.py开启调试模式  
- 启动时自动建表  
- 缺失时创建默认管理员账户  

本系统适配Replit等平台部署，支持环境变量配置，可自动初始化数据库表结构及默认用户。
